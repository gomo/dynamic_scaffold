<%= form_with method: method, model: @record, url: url, local: true do |form| %>
  <%-dynamic_scaffold.form.items.each do |elem|-%>
    <% if elem.needs_rendering?(self)%>
      <% if !elem.label? && elem.type?(:hidden_field) %>
        <%= elem.render(self, form) %>
      <% else %>
        <div class="<%= class_names('form-group', {'has-error': @record.errors[elem.proxy_field.name].any?}) %>">
          <label><%= elem.proxy_field.label %></label>
          <div class="clearfix">
            <%- elem.insert(:before).each do |block| -%>
              <%= self.instance_exec(@record, &block) %>
            <%-end-%>
            <% if elem.type? :collection_check_boxes %>
              <%= elem.render(self, form) do |cb|%>
                <div class="form-check checkbox">
                  <%= cb.label class: 'form-check-label' do%>
                    <%= cb.check_box class: 'form-check-input' %> <%= cb.text %> 
                  <%end%>
                </div>
              <%end%>
            <% elsif elem.type? :collection_radio_buttons %>
              <%= elem.render(self, form) do |cb|%>
                <div class="form-check radio">
                  <%= cb.label class: 'form-check-label' do%>
                    <%= cb.radio_button class: 'form-check-input' %> <%= cb.text %> 
                  <%end%>
                </div>
              <%end%>
            <% elsif elem.type? :image %>
              <%- image = form.object.public_send(elem.name) -%>
              <div class="dynamicScaffoldJs-image-wrapper">
                <div class="dynamicScaffoldJs-image-preview panel panel-default card mb-1" style="<%= elem.preview_image_style %>">
                  <div class="text-right panel-heading card-header">
                    <button type="button" class="btn btn-outline-danger btn-danger btn-sm dynamicScaffoldJs-image-remove">
                      <%= dynamic_scaffold_icon :times %>
                    </button>
                  </div>
                  <img src="<%= image.url if image.file.present? %>" alt="" class="img-responsive img-fluid">
                </div>
                <%= form.hidden_field "remove_#{elem.name}", value: "1", disabled:"disabled", class: 'dynamicScaffoldJs-image-remove-flag'%>
                <%= elem.render(self, form, 'form-control-file dynamicScaffoldJs-image') do |attr|%>
                  <%= form.file_field(elem.name, attr) %>
                <%end%>
              </div>
            <% else %>
              <%= elem.render(self, form, class_names('form-control', {'is-invalid': @record.errors[elem.proxy_field.name].any?})) %>
            <% end %>
            <%- elem.insert(:after).each do |block| -%>
              <%= self.instance_exec(@record, &block) %>
            <%-end-%>
          </div>
          <%if @record.errors[elem.proxy_field.name].any?%>
            <ul class="dynamicScaffold-error-message">
              <%@record.errors.full_messages_for(elem.proxy_field.name).each do |err|%>
              <li><%= dynamic_scaffold_icon :error %> <%= err %></li>
              <%end%>
            </ul>
          <%end%>
          <%if elem.notes?%>
            <div class="form-text text-muted"><%= elem.render_notes(form.object, self) %></div>
          <%end%>
        </div>
      <% end %>
    <% end %>
  <% end %>
  <div>
    <% path_options = dynamic_scaffold.list.pagination ? {dynamic_scaffold.list.pagination.param_name => params[:page]} : {}%>
    <%= link_to dynamic_scaffold_path(:index, path_options), class: 'btn btn-outline-secondary btn-default' do%>
      <%= dynamic_scaffold_icon :back %> <%= t('dynamic_scaffold.button.back') %>
    <%end%>
    <button type="submit" class="btn btn-outline-warning btn-warning">
      <%= dynamic_scaffold_icon :save %> <%= t('dynamic_scaffold.button.save') %>
    </a>
  </div>
<% end %>